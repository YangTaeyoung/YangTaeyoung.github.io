---
layout: post
title: AWS Secrets Manager를 활용해서 로컬 시크릿을 잘 관리하는 방법
parent: <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
	<path fill="#252f3e" d="M13.527,21.529c0,0.597,0.064,1.08,0.176,1.435c0.128,0.355,0.287,0.742,0.511,1.161 c0.08,0.129,0.112,0.258,0.112,0.371c0,0.161-0.096,0.322-0.303,0.484l-1.006,0.677c-0.144,0.097-0.287,0.145-0.415,0.145 c-0.16,0-0.319-0.081-0.479-0.226c-0.224-0.242-0.415-0.5-0.575-0.758c-0.16-0.274-0.319-0.58-0.495-0.951 c-1.245,1.483-2.81,2.225-4.694,2.225c-1.341,0-2.411-0.387-3.193-1.161s-1.181-1.806-1.181-3.096c0-1.37,0.479-2.483,1.453-3.321 s2.267-1.258,3.911-1.258c0.543,0,1.102,0.048,1.692,0.129s1.197,0.21,1.836,0.355v-1.177c0-1.225-0.255-2.08-0.75-2.58 c-0.511-0.5-1.373-0.742-2.602-0.742c-0.559,0-1.133,0.064-1.724,0.21c-0.591,0.145-1.165,0.322-1.724,0.548 c-0.255,0.113-0.447,0.177-0.559,0.21c-0.112,0.032-0.192,0.048-0.255,0.048c-0.224,0-0.335-0.161-0.335-0.5v-0.79 c0-0.258,0.032-0.451,0.112-0.564c0.08-0.113,0.224-0.226,0.447-0.339c0.559-0.29,1.229-0.532,2.012-0.726 c0.782-0.21,1.612-0.306,2.49-0.306c1.9,0,3.289,0.435,4.183,1.306c0.878,0.871,1.325,2.193,1.325,3.966v5.224H13.527z M7.045,23.979c0.527,0,1.07-0.097,1.644-0.29c0.575-0.193,1.086-0.548,1.517-1.032c0.255-0.306,0.447-0.645,0.543-1.032 c0.096-0.387,0.16-0.855,0.16-1.403v-0.677c-0.463-0.113-0.958-0.21-1.469-0.274c-0.511-0.064-1.006-0.097-1.501-0.097 c-1.07,0-1.852,0.21-2.379,0.645s-0.782,1.048-0.782,1.854c0,0.758,0.192,1.322,0.591,1.709 C5.752,23.786,6.311,23.979,7.045,23.979z M19.865,25.721c-0.287,0-0.479-0.048-0.607-0.161c-0.128-0.097-0.239-0.322-0.335-0.629 l-3.752-12.463c-0.096-0.322-0.144-0.532-0.144-0.645c0-0.258,0.128-0.403,0.383-0.403h1.565c0.303,0,0.511,0.048,0.623,0.161 c0.128,0.097,0.223,0.322,0.319,0.629l2.682,10.674l2.49-10.674c0.08-0.322,0.176-0.532,0.303-0.629 c0.128-0.097,0.351-0.161,0.639-0.161h1.277c0.303,0,0.511,0.048,0.639,0.161c0.128,0.097,0.239,0.322,0.303,0.629l2.522,10.803 l2.762-10.803c0.096-0.322,0.208-0.532,0.319-0.629c0.128-0.097,0.335-0.161,0.623-0.161h1.485c0.255,0,0.399,0.129,0.399,0.403 c0,0.081-0.016,0.161-0.032,0.258s-0.048,0.226-0.112,0.403l-3.847,12.463c-0.096,0.322-0.208,0.532-0.335,0.629 s-0.335,0.161-0.607,0.161h-1.373c-0.303,0-0.511-0.048-0.639-0.161c-0.128-0.113-0.239-0.322-0.303-0.645l-2.474-10.4 L22.18,24.915c-0.08,0.322-0.176,0.532-0.303,0.645c-0.128,0.113-0.351,0.161-0.639,0.161H19.865z M40.379,26.156 c-0.83,0-1.66-0.097-2.458-0.29c-0.798-0.193-1.421-0.403-1.836-0.645c-0.255-0.145-0.431-0.306-0.495-0.451 c-0.064-0.145-0.096-0.306-0.096-0.451v-0.822c0-0.339,0.128-0.5,0.367-0.5c0.096,0,0.192,0.016,0.287,0.048 c0.096,0.032,0.239,0.097,0.399,0.161c0.543,0.242,1.133,0.435,1.756,0.564c0.639,0.129,1.261,0.193,1.9,0.193 c1.006,0,1.788-0.177,2.331-0.532c0.543-0.355,0.83-0.871,0.83-1.532c0-0.451-0.144-0.822-0.431-1.129 c-0.287-0.306-0.83-0.58-1.612-0.838l-2.315-0.726c-1.165-0.371-2.027-0.919-2.554-1.645c-0.527-0.709-0.798-1.499-0.798-2.338 c0-0.677,0.144-1.274,0.431-1.79s0.671-0.967,1.149-1.322c0.479-0.371,1.022-0.645,1.66-0.838C39.533,11.081,40.203,11,40.906,11 c0.351,0,0.718,0.016,1.07,0.064c0.367,0.048,0.702,0.113,1.038,0.177c0.319,0.081,0.623,0.161,0.91,0.258s0.511,0.193,0.671,0.29 c0.224,0.129,0.383,0.258,0.479,0.403c0.096,0.129,0.144,0.306,0.144,0.532v0.758c0,0.339-0.128,0.516-0.367,0.516 c-0.128,0-0.335-0.064-0.607-0.193c-0.91-0.419-1.932-0.629-3.065-0.629c-0.91,0-1.628,0.145-2.123,0.451 c-0.495,0.306-0.75,0.774-0.75,1.435c0,0.451,0.16,0.838,0.479,1.145c0.319,0.306,0.91,0.613,1.756,0.887l2.267,0.726 c1.149,0.371,1.98,0.887,2.474,1.548s0.734,1.419,0.734,2.257c0,0.693-0.144,1.322-0.415,1.87 c-0.287,0.548-0.671,1.032-1.165,1.419c-0.495,0.403-1.086,0.693-1.772,0.903C41.943,26.043,41.193,26.156,40.379,26.156z"></path><path fill="#f90" d="M43.396,33.992c-5.252,3.918-12.883,5.998-19.445,5.998c-9.195,0-17.481-3.434-23.739-9.142 c-0.495-0.451-0.048-1.064,0.543-0.709c6.769,3.966,15.118,6.369,23.755,6.369c5.827,0,12.229-1.225,18.119-3.741 C43.508,32.364,44.258,33.347,43.396,33.992z M45.583,31.477c-0.671-0.871-4.438-0.419-6.146-0.21 c-0.511,0.064-0.591-0.387-0.128-0.726c3.001-2.128,7.934-1.516,8.509-0.806c0.575,0.726-0.16,5.708-2.969,8.094 c-0.431,0.371-0.846,0.177-0.655-0.306C44.833,35.927,46.254,32.331,45.583,31.477z"></path>
	</svg> AWS
date: 2023-09-23
---
## Table of contents
{: .no_toc .text-delta }

1. TOC
   {:toc}
--- 
# 개요
![](../../assets/images/aws/ca97b1f1a197a40a8559e7ec60c76f99.png)
회사에서 로컬로 시크릿을 공유하다 보면 Slack, 카카오톡 과 같은 메신저를 통해 시크릿을 주고 받는 일이 종종 생긴다.

이유는 종종 다음과 같은데
1. 변경 사항에 대한 대응으로 기존 로컬 Secret를 갱신해야 하는 경우
2. 신규 입사 시 초기 Secret를 설정해야하는 경우

이런 방법은 메신저라는 공유 채널에 Secret에 대한 민감한 정보가 남기도 하고, 여러가지 보안적인 측면에서 좋지 못하다고 느꼈다.

# AWS Secret Generator
그래서 만들었다. Golang으로 제작한 간단한 CLI 툴이며, AWS Secrets Manager에서 보관 중인 Secret들을 간단한 CLI를 통해 가져오고 로컬에 파일의 형태로 가져올 수 있다.

## Usage
### 준비물
- AWS Access Key ID, AWS Secret Access Key 는 사전에 공유되어 있음을 가정한다.

- AWS Secrets Manager 셋업
	- 먼저 Secrets Manager에 들어가서 설정을 셋업한다. 해당 란에서 `새 보안 암호 저장`을 선택
		![](../../assets/images/aws/87c03916f4df676c72ea8f2d4df1f931.png)
	- 보안 암호 유형을 선택한다. 필자는 여러가지 설정이 포함된 복합적인 형태의 config를 셋업하는 시나리오를 고려하여 다른 유형의 보안암호를 설정하였다. (AWS와 관련된 서비스의 특정 Secret을 설정하고 싶다면 다른 유형의 보안암호를 선택해도 좋다.)
		![](../../assets/images/aws/183eaa88819bf03cd18361ee02299a67.png)
	- 일반 텍스트 형식을 탭하여, 현재 사용하고 있는 local secrets의 파일을 복사 붙여넣기 하여 생성한다.
		- 키 값 페어를 사용하여 JSON형태로 강제하는 방식도 물론 가능하다.
		- 필자는 yaml 형식으로 `hello: world`와 같은 단순한 secrets를 사용한다고 가정했다.
			- 실제 config를 셋업할 때는 local에서 구동가능한 config를 셋업하여야 한다.
		![](../../assets/images/aws/1d235b2010321e4bf01dfc7af304db56.png)
	- 보안 암호명,  설명을 입력한다. 보안 암호명은 이후 과정에서 cli프로그램에서 선택하는 키 값이 되므로, 잘 기억해두도록 한다.
		![](../../assets/images/aws/fe2928dc06e69bdefc2b21bdff858e7b.png)
	- 설정한 Secrets를 주기적으로 다른 Secrets로 교체시킬 것인지에 대한 부분이다. 필자는 따로 해당 기능을 사용하지 않는다고 가정했기 때문에 설정하지 않았다.
		![](../../assets/images/aws/303a9ecff2da5bfb442749924e0d12ba.png)
	- 다음 스탭에서 저장 버튼을 누르면 Secrets가 생성된다.
		  ![](../../assets/images/aws/a9857abe3a02fef5b14cbd61281b8d1a.png)
- 전반적인 CLI 설치는 다음 레파지토리의 설명을 따른다.
	- https://github.com/YangTaeyoung/aws-secret-gen
- aws-secret-gen 사용하기
	- 커맨드 라인에 다음을 입력한다.
	```bash
	$ aws-secret-gen -o test-config.yaml{저장할 파일 경로}
	```
	- 그럼 다음과 같이 AWS Access Key ID와 Secret Access Key, Region을 설정하는 창이 나온다.
		- 사전에 준비한 키와 리전을 입력하도록 한다.
		```bash
		>  Enter AWS Access Key ID: {준비한 AWS Access Key ID}
		>  Secret AWS Secret Access Key: {준비한 AWS Secret Access Key}
		>  Enter AWS Region: {AWS Region 키: 서울인 경우 ap-northeast-2}
	   ```
	- 이후 시크릿 리스트가 뜬다. 본인이 생성한 Secret를 가져온다.
	```bash
	Use the arrow keys to navigate: ↓ ↑ → ←
	? Select Secret:
		...
	  ▸ test-config
	```
	- 엔터를 누르면 본인이 설정한 경로에 시크릿이 잘 생성되었음을 확인할 수 있다.
	```bash
	$ cat ./test-config.yaml
	> hello: world
	```